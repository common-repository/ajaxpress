var d=Object.defineProperty;var g=(n,t,e)=>t in n?d(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var p=(n,t,e)=>(g(n,typeof t!="symbol"?t+"":t,e),e),w=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var s=(n,t,e)=>(w(n,t,"read from private field"),e?e.call(n):t.get(n)),l=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)};var i,o;const m=class m{constructor(){p(this,"instance",null);l(this,i,{});l(this,o,{clicked:[],fetched:[],changed:[],html:null});this.registerEvents()}on(t,e){typeof s(this,o)[t]=="object"&&s(this,o)[t]&&s(this,o)[t].push(e)}off(t,e){typeof s(this,o)[t]=="object"&&s(this,o)[t]&&(s(this,o)[t]=s(this,o)[t].filter(r=>r!==e))}clicked(t){this.on("clicked",t)}fetched(t){this.on("fetched",t)}changed(t){this.on("changed",t)}html(t){typeof t=="object"&&(s(this,o).html=t)}trigger(t,e){s(this,o)[t]&&s(this,o)[t].forEach(r=>{r(e)})}get url(){return s(this,i).url||this.currentURL}get html(){return s(this,o).html?s(this,o).html(s(this,i).html):s(this,i).html||""}get target(){return ajaxpress.options.target||"main"}static getInstance(){return this.instance||(this.instance=new m),this.instance}isSameOrigin(t){try{const e=new URL(t),r=new URL(window.location.href);return e.origin===r.origin}catch(e){return!1}}isSameURL(t){const e=new URL(t),r=new URL(window.location.href);return e.origin===r.origin&&e.pathname===r.pathname}get currentURL(){return window.location.href}registerEvents(){ajaxpress.options.navigation&&(document.addEventListener("click",this.processHyperlink.bind(this)),window.addEventListener("popstate",this.popState.bind(this))),(ajaxpress.options.comment||ajaxpress.options.search)&&document.addEventListener("submit",this.processForm.bind(this)),ajaxpress.options.search&&ajaxpress.options.live_search&&document.addEventListener("keypress",this.processSearch.bind(this))}async processSearch(t){t.target.type==="search"&&(s(this,i).url=t.target.form.action+"?s="+t.target.value,!s(this,i).throttle&&(s(this,i).throttle=setTimeout(()=>{clearInterval(s(this,i).throttle),s(this,i).throttle=null},500),s(this,i).push=!0,await this.load(),t.target.focus()))}isURLLoadable(t){if(!(!ajaxpress.options.navigation||!this.isSameOrigin(t)||t.includes("wp-admin")||t.includes("wp-login")||t.includes("wp-login")||["pdf","doc","docx","xls","xlsx","ppt","pptx","zip","rar","mp3","mp4","mov","avi","wmv","jpg","jpeg","png","gif","svg"].some(r=>t.includes(r)))&&!t.includes("mailto:")&&!t.includes("tel:")&&!(this.isSameURL(t)&&t.includes("#")))return!0}async processHyperlink(t){t.target.tagName==="A"&&this.isURLLoadable(t.target.href)&&(t.preventDefault(),s(this,i).url=t.target.href,s(this,i).push=!0,await this.load())}async popState(t){!t.state.url||!this.isURLLoadable(t.state.url)||(s(this,i).url=t.state.url,s(this,i).push=!1,await this.load())}async fetch(){const e=await(await fetch(this.url)).text();s(this,i).html=e||""}async render(){const e=new DOMParser().parseFromString(this.html,"text/html"),r=e.querySelector("title").innerHTML;document.title=r;const a=e.querySelector(this.target).innerHTML||e.querySelector("body").innerHTML,h=document.querySelector(this.target)||document.querySelector("body");if(h&&(h.innerHTML=a),s(this,i).push){const c={title:r,content:a,url:this.url};window.history.pushState(c,r,this.url)}s(this,i).noScroll||window.scrollTo({top:0,behavior:"smooth"})}async load(){await this.fetch(),this.trigger("fetched",{url:this.url,html:this.html}),await this.render(),this.trigger("changed",{url:this.url,html:this.html})}async processForm(t){const e=t.target,r='.wp-block-search,.search-form,.comment-form,form[role="search"], #commentform';if(!e.matches(r)||e.matches('.wp-block-search,.search-form,form[role="search"]')&&!ajaxpress.options.search||e.matches(".comment-form,#commentform")&&!ajaxpress.options.comment)return!0;t.preventDefault(),this.submitForm(e)}async submitForm(t){const e=t.action,r=t.method,a=r==="get"?new URLSearchParams(new FormData(t)).toString():new FormData(t),h=r==="get"?`${e}?${a}`:e;if(r.toLowerCase()==="get")s(this,i).url=h,s(this,i).push=!0,await this.load(),s(this,i).push=!1;else{if(await fetch(h,{method:r,body:a}),s(this,i).noScroll=!0,await this.load(),t.classList.contains("comment-form")){const c=document.querySelectorAll(".comment"),f=c[c.length-1];f&&f.scrollIntoView({behavior:"smooth"})}s(this,i).noScroll=!1}}};i=new WeakMap,o=new WeakMap;let u=m;const y=u.getInstance();window.AjaxPress=y;
//# sourceMappingURL=app.min.js.map
