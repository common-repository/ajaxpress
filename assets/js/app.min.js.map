{"version":3,"file":"app.min.js","sources":["../../src/ajaxpress.js","../../src/app.js"],"sourcesContent":["class AjaxPress {\n    instance = null;\n    #state = {};\n    #callbacks = {\n        clicked: [],\n        fetched: [],\n        changed: [],\n        html: null,\n    }\n    // on\n    on(event, callback) {\n        if (typeof this.#callbacks[event] !== 'object') return;\n\n        if (this.#callbacks[event]) {\n            this.#callbacks[event].push(callback);\n        }\n    }\n\n    // off\n    off(event, callback) {\n        if (typeof this.#callbacks[event] !== 'object') return;\n\n        if (this.#callbacks[event]) {\n            this.#callbacks[event] = this.#callbacks[event].filter(cb => cb !== callback);\n        }\n    }\n\n    clicked(callback) {\n        this.on('clicked', callback);\n    }\n\n    fetched(callback) {\n        this.on('fetched', callback);\n    }\n\n    changed(callback) {\n        this.on('changed', callback);\n    }\n\n    // html\n    html(callback) {\n        if (typeof callback !== 'object') return;\n\n        this.#callbacks.html = callback;\n    }\n\n    // trigger\n    trigger(event, data) {\n        if (this.#callbacks[event]) {\n            this.#callbacks[event].forEach(callback => {\n                callback(data);\n            })\n        }\n    }\n\n    get url() { return this.#state.url || this.currentURL };\n    get html() {\n        if (this.#callbacks.html) {\n            return this.#callbacks.html(this.#state.html);\n        }\n\n        return this.#state.html || '';\n    };\n    get target() { return ajaxpress.options.target || 'main' };\n\n    static getInstance() {\n        if (!this.instance) {\n            this.instance = new AjaxPress();\n        }\n        return this.instance;\n    }\n\n    constructor() {\n        this.registerEvents();\n    }\n\n\n    isSameOrigin(url) {\n        try {\n            const a = new URL(url);\n            const b = new URL(window.location.href);\n            return a.origin === b.origin;\n        } catch (e) {\n            return false\n        }\n\n    }\n\n    isSameURL(url) {\n        // match url, even they have different hash and query string\n        const a = new URL(url);\n        const b = new URL(window.location.href);\n        return a.origin === b.origin && a.pathname === b.pathname;\n    }\n\n    get currentURL() {\n        return window.location.href;\n    }\n\n    registerEvents() {\n        if (ajaxpress.options.navigation) {\n            // on click any a \n            document.addEventListener('click', this.processHyperlink.bind(this));\n\n            // on popstate\n            window.addEventListener('popstate', this.popState.bind(this));\n        }\n\n        if (ajaxpress.options.comment || ajaxpress.options.search) {\n\n            // on submit form\n            document.addEventListener('submit', this.processForm.bind(this));\n        }\n\n        if (ajaxpress.options.search && ajaxpress.options.live_search) {\n            // on keypress on type=\"search\"\n            document.addEventListener('keypress', this.processSearch.bind(this));\n        }\n\n    }\n\n    async processSearch(e) {\n        if (e.target.type !== 'search') return;\n\n        this.#state.url = e.target.form.action + '?s=' + e.target.value;\n\n\n        if (this.#state.throttle) return;\n\n        this.#state.throttle = setTimeout(() => {\n            clearInterval(this.#state.throttle);\n            this.#state.throttle = null;\n        }, 500);\n\n        this.#state.push = true;\n\n        await this.load();\n\n        // focus \n        e.target.focus();\n    }\n\n    isURLLoadable(url) {\n\n        // Bail, if options.navigation is false\n        if (!ajaxpress.options.navigation) return;\n\n        // Bail if the URL is not from the same origin  \n        if (!this.isSameOrigin(url)) return;\n\n        // Bail if the URL is admin url, login url, or logout url\n        if (url.includes('wp-admin') || url.includes('wp-login') || url.includes('wp-login')) return;\n\n        // Bail if the URL is a file\n        const fileExtensions = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'zip', 'rar', 'mp3', 'mp4', 'mov', 'avi', 'wmv', 'jpg', 'jpeg', 'png', 'gif', 'svg'];\n        if (fileExtensions.some(ext => url.includes(ext))) return;\n\n        // Bail if the URL is a mailto link\n        if (url.includes('mailto:')) return;\n\n        // Bail if the URL is a tel link\n        if (url.includes('tel:')) return;\n\n        // Bail if the URL is a same page link with a hash \n        if (this.isSameURL(url) && url.includes('#')) return;\n\n        return true;\n    }\n\n    async processHyperlink(e) {\n\n        // bail if not a tag \n        if (e.target.tagName !== 'A') return;\n\n        if (!this.isURLLoadable(e.target.href)) return;\n\n        e.preventDefault();\n\n        this.#state.url = e.target.href;\n\n        this.#state.push = true;\n\n        await this.load()\n    }\n\n    async popState(e) {\n        if (!e.state.url || !this.isURLLoadable(e.state.url)) return;\n\n        this.#state.url = e.state.url;\n        this.#state.push = false;\n\n        await this.load()\n    }\n\n    async fetch() {\n        const response = await fetch(this.url);\n        const html = await response.text();\n        this.#state.html = html || '';\n    }\n    async render() {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(this.html, 'text/html');\n\n        // replace title \n        const title = doc.querySelector('title').innerHTML;\n        document.title = title;\n\n        // replace content\n        const content = doc.querySelector(this.target).innerHTML || doc.querySelector('body').innerHTML;\n        const container = document.querySelector(this.target) || document.querySelector('body');\n        if (container) container.innerHTML = content;\n\n        // push state\n        if (this.#state.push) {\n            const state = { title, content, url: this.url };\n            window.history.pushState(state, title, this.url);\n        }\n\n        // scroll to top smooth\n        if (this.#state.noScroll) return;\n\n        window.scrollTo({\n            top: 0,\n            behavior: 'smooth'\n        });\n    }\n\n    async load() {\n        await this.fetch();\n\n        // before change\n        this.trigger('fetched', {\n            url: this.url,\n            html: this.html\n        });\n        await this.render();\n\n        // after change\n        this.trigger('changed', {\n            url: this.url,\n            html: this.html\n        });\n    }\n\n    async processForm(e) {\n\n        const form = e.target;\n\n        const forms = '.wp-block-search,.search-form,.comment-form,form[role=\"search\"], #commentform';\n\n        if (!form.matches(forms)) {\n            return true;\n        }\n\n        // check if search form and options.search is true \n        if (form.matches('.wp-block-search,.search-form,form[role=\"search\"]') && !ajaxpress.options.search) {\n            return true;\n        }\n\n        // check if comment form and options.comments is true\n        if (form.matches('.comment-form,#commentform') && !ajaxpress.options.comment) {\n            return true;\n        }\n        e.preventDefault();\n        this.submitForm(form)\n    }\n\n    async submitForm(form) {\n        const action = form.action\n        const method = form.method;\n\n        // Get the form data\n        const formData = method === 'get' ? new URLSearchParams(new FormData(form)).toString() : new FormData(form);\n        const finalAction = method === 'get' ? `${action}?${formData}` : action;\n\n        if (method.toLowerCase() === 'get') {\n            // Fetch the page\n            this.#state.url = finalAction;\n            // before change\n            this.#state.push = true;\n            await this.load()\n            this.#state.push = false;\n\n        } else {\n            // Submit the form using ajax\n            const response = await fetch(finalAction, {\n                method,\n                body: formData,\n            });\n\n            this.#state.noScroll = true;\n\n            await this.load()\n\n            // scroll to nearest comment\n            if (form.classList.contains('comment-form')) {\n                const comments = document.querySelectorAll('.comment');\n                const lastComment = comments[comments.length - 1];\n                if (lastComment) {\n                    lastComment.scrollIntoView({\n                        behavior: 'smooth'\n                    });\n                }\n            }\n\n            this.#state.noScroll = false;\n        }\n\n\n    }\n}\n\nexport default AjaxPress.getInstance();","import AjaxPress from \"./ajaxpress\";\nwindow.AjaxPress = AjaxPress;"],"names":["_state","_callbacks","_AjaxPress","__publicField","__privateAdd","event","callback","__privateGet","cb","data","url","a","b","e","ext","html","doc","title","content","container","state","form","forms","action","method","formData","finalAction","comments","lastComment","AjaxPress","AjaxPress$1"],"mappings":"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"}